(function(factory){if(typeof define==='function'&&define.amd){define(['jquery','mooPhrase'],factory);}else if(typeof exports!=='undefined'){module.exports=factory(require('jquery'));}else{root.mooSimpleModal=factory();}}(function($,mooPhrase){var self=null;$.fn.extend({buttons:null,options:null,defaults:{onAppend:null,offsetTop:null,overlayOpacity:.3,overlayColor:"#000000",width:400,draggable:true,keyEsc:true,overlayClick:false,closeButton:true,hideHeader:false,hideFooter:true,btn_ok:mooPhrase.__('btn_ok'),btn_cancel:mooPhrase.__('btn_cancel'),template:"<div class=\"simple-modal-header title-modal\"> \
                {_TITLE_} \
            </div> \
                <div class=\"simple-modal-body modal-body\"> \
                <div class=\"contents\" id=\"simple-modal-body\">{_CONTENTS_}</div> \
            </div> \
                <div class=\"simple-modal-footer\"></div>"},SimpleModal:function(options){self=this;this.buttons=[];this.options=$.extend({},self.defaults,options);return this;},showModal:function(){var node=null;switch(this.options.model){case"modal-ajax":node=this._drawWindow(this.options);this._loadContents({"url":self.options.param.url||"","onRequestComplete":this.options.param.onRequestComplete});break;case"confirm":this.addButton(this.options.btn_ok,"btn btn-action",function(){self.options.callback();self.hideModal();});this.addButton(this.options.btn_cancel,"button button-action");node=this._drawWindow(this.options);break;case"modal":this.addButton(this.options.btn_ok,"btn btn-action",function(){self.hideModal();});node=this._drawWindow(this.options);break;case"content":node=this._drawWindow(this.options);break;default:this.addButton(this.options.btn_ok,"button button-action primary");node=this._drawWindow(this.options);break;}if(node){this._display();}},hideModal:function(){self._overlay('hide');$('.modal-backdrop').remove();$('#simpleModal').remove();},_drawWindow:function(options){var node=$("<div>").addClass('simple-modal modal-dialog').attr('id','simple-modal');node.html($("<div>").addClass('modal-content').html(this._template(self.options.template,{"_TITLE_":options.title||"Untitled","_CONTENTS_":options.contents||""})));node=$("<div>").addClass("modal fade in").attr('id','simpleModal').attr('aria-hidden',false).attr('aria-labelledby','myModalLabel').attr('role','basic').css({'display':'block'}).html(node);$('body').append(node);$('body').append('<div class="modal-backdrop fade in"></div>');this._injectAllButtons();if(this.options.onAppend){this.options.onAppend.call(this);}return node;},addButton:function(label,classe,clickEvent){var bt=$('<a>').attr({"title":label,"class":classe}).click(clickEvent?function(e){clickEvent.call(self,e);}:self.hideModal).text(label);this.buttons.push(bt);return this;},_injectAllButtons:function(){var footer=$("#simple-modal").find(".simple-modal-footer");$.each(self.buttons,function(i,e){footer.append(e);});},_addCloseButton:function(){var b=$("<a>").addClass('close').attr({"href":"#"}).html('<i class="icon-remove"></i>').click(function(e){self.hideModal();return false;});$("#simple-modal").append(b);return b;},_overlay:function(status){switch(status){case'show':var overlay=$("<div>").attr("id","simple-modal-overlay").css({"background-color":this.options.overlayColor,"opacity":0});$('body').append(overlay);overlay.animate({opacity:this.options.overlayOpacity});if(this.options.overlayClick){overlay.click(function(e){self.hideModal();});}$(window).resize(self._display);$(document).keyup(self._escape);break;case'hide':$('#simple-modal-overlay').remove();$('#simple-modal').remove();$(window).unbind('resize',self._display);$(document).unbind('keyup',self._escape);}},_escape:function(e){if(e.keyCode==27)self.hideModal();},_loadContents:function(param){$('#simple-modal-body').spin('small');var re=new RegExp(/([^\/\\]+)\.(jpg|png|gif)$/i),container=$('#simple-modal');if(param.url.match(re)){container.addClass("hide-footer");$("#simple-modal-overlay").unbind();var image=$('<img>').attr('src',param.url).load(function(){var content=container.find(".contents").empty().append($(this).css('opacity',0));var dw=container.width()-content.width(),dh=container.height()-content.height();var width=$(this).width()+dw,height=$(this).height()+dh;container.animate({width:width,height:height,left:($(window).width()-width)/2,top:($(window).height()-height)/2},200,function(){image.animate({opacity:1});});});}else{$('#simple-modal .contents').load(param.url,function(responseText,textStatus,XMLHttpRequest){var container=$('#simple-modal');if(textStatus!=='success'){container.find(".contents").html("loading failed");if(param.onRequestFailure){param.onRequestFailure();}}else{if(param.onRequestComplete){param.onRequestComplete();}self._display();}});}},_display:function(){$("#simple-modal-overlay").css({width:$(window).width(),height:$(window).height()});var modal=$("#simple-modal"),top=self.options.offsetTop||($(window).height()-modal.height())/2;},_template:function(s,d){for(var p in d){s=s.replace(new RegExp('{'+p+'}','g'),d[p]);}return s;}});}));