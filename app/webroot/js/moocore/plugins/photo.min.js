(function(a,f){"function"===typeof define&&define.amd?define("jquery mooBehavior mooAlert mooAjax mooPhrase mooOverlay mooPhotoTheater mooLike hideshare spinner".split(" "),f):"object"===typeof exports?module.exports=f(require("jquery")):a.mooPhoto=f()})(this,function(a,f,p,Q,h,D,L,M){var q=!1,g=!1,k,l,r,t,u,v,w,x,d=0,m=0,y=0,n=0,E=2,G=function(){a(".showPhoto").unbind("click");a(".showPhoto").on("click",function(){var b=a(this).data();F(b.id)})},N=function(){var b=!1;a("#photoModal").on("hidden.bs.modal",
function(){b&&location.reload()});a(".rotate_img").unbind("click");a(".rotate_img").on("click",function(){a(".rotate_img").hide();var c=a(this).data();a("#photo_wrapper").spin("large");var e=c.id;a.post(mooConfig.url.base+"/photos/ajax_rotate",{id:e,mode:c.mode},function(c){b=!0;dataJson=JSON.parse(c);console.log(dataJson["1500"]);a("#photo_wrapper").spin(!1);a(".rotate_img").show();a("#photo_src").attr("src",dataJson["1500"]);a("#photo_thumb_"+e+" > a > img").attr("src",dataJson["75_square"]);a("#layer_square_modal_"+
e).length&&(c=a("#layer_square_modal_"+e).css("background-image"),c=c.replace(/^url\(['"]?/,"").replace(/['"]?\)$/,""),c+="?"+(new Date).getTime(),a("#layer_square_modal_"+e).css("background-image","url("+c+")"));a("#layer_square_"+e).length&&(c=a("#layer_square_"+e).css("background-image"),c=c.replace(/^url\(['"]?/,"").replace(/['"]?\)$/,""),c+="?"+(new Date).getTime(),a("#layer_square_"+e).css("background-image","url("+c+")"));a(".photoModal").each(function(){var b=a(this).find("img:first");b.attr("src",
b.attr("src")+"?"+(new Date).getTime())})})})},H=function(){a("#photo_wrapper").spin("large");a.post(mooConfig.url.base+"/photos/ajax_fetch",{type:type,album_type:album_type,album_type_id:album_type_id,target_id:target_id,page:E,taguserid:n},function(b){a("#photo_wrapper").spin(!1);""!=b&&(E++,a("#photo_thumbs ul").append(b),a("#photo_load_btn").parent().remove(),a("#photo_load_btn").unbind("click"),a("#photo_load_btn").on("click",function(){H()}),a(".showPhoto").unbind("click"),a(".showPhoto").on("click",
function(){var b=a(this).data();F(b.id)}))})},O=function(){a("#set_cover").spin("tiny");a.post(mooConfig.url.base+"/users/set_photo_as_cover",{photo_id:d},function(b){b=a.parseJSON(b);window.location=b.url})},B=function(){g=!0;a("#tag-wrapper img").css("cursor","crosshair");a("#tagPhoto a").html(h.__("done_tagging"));a("#tag-wrapper img").unbind("click");a("#tag-wrapper img").click(function(b){g&&(r=b.pageX-a("#tag-wrapper").offset().left,t=b.pageY-a("#tag-wrapper").offset().top,u=a("#tag-target").outerWidth(),
v=a("#tag-target").outerHeight(),k=r-u/2,l=t-v/2,w=r+u/2,x=t-v/2,"block"==a("#tag-target").css("display")?(a("#tag-target").animate({left:k,top:l},500),a("#tag-input").animate({left:w,top:x},500)):(a("#tag-target").css({left:k,top:l}).fadeIn(),a("#tag-input").css({left:w,top:x}).fadeIn()),a("#tag-name").focus(),a("#friends_list").html(a("#friends").html()),a(".tagFriends").unbind("click"),a(".tagFriends").on("click",function(){var b=a(this).data();z(b.id,b.tagValue)}))});a("#tag-cancel").unbind("click");
a("#tag-cancel").click(function(){A();return!1});a("#tag-name").keyup(function(a){13==a.keyCode&&z(0,"")});a("#tag-submit").unbind("click");a("#tag-submit").click(function(){z(0,"");return!1})},z=function(b,c){if(""!=b||""!=a("#tag-name").val()){var e="left:"+k+"px; top:"+l+"px";a("#photo_wrapper").spin("large");a.post(mooConfig.url.base+"/photos/ajax_tag",{photo_id:d,uid:b,value:a("#tag-name").val(),style:e},function(d){a("#photo_wrapper").spin(!1);d=a.parseJSON(d);1==d.result?(c=b?'<a href="'+mooConfig.url.base+
"/users/view/"+b+'">'+c+"</a>":a("#tag-name").val(),a("#tags").append('<span class="photoDetailTags" id="hotspot-item-'+m+"-"+d.id+'" data-tag-id="'+d.id+'" id="hotspot-item-'+m+'">'+c+'<a class="photoDetailRemoveTags" data-id="'+d.id+'" href="javascript:void(0)"><i class="material-icons cross-icon-sm">clear</i></a></span>'),a("#tag-wrapper").append('<div id="hotspot-'+m+"-"+d.id+'" class="hotspot" style="'+e+'"><span>'+c+"</span></div>"),A(),m++,a(".photoDetailTags").off("mouseout"),a(".photoDetailTags").off("mouseover"),
a(".photoDetailTags").on("mouseout",function(){var b=a(this).data();I("0-"+b.tagId)}).on("mouseover",function(){var b=a(this).data();J("0-"+b.tagId)}),a(".photoDetailRemoveTags").unbind("click"),a(".photoDetailRemoveTags").on("click",function(){var b=a(this).data();K("0-"+b.id,b.id)})):p.alert(d.message)})}},P=function(){a("#set_avatar").spin("tiny");a.post(mooConfig.url.base+"/users/set_photo_as_profile_picture",{photo_id:d},function(b){b=a.parseJSON(b);window.location=b.url})},F=function(b){d=b;
a("#photo_wrapper").spin("large");var c="";q=!1;c=y?b+"/uid:"+y:n?b+"?uid="+n:b;a("#preload").load(mooConfig.url.base+"/photos/ajax_view/"+c,{noCache:1},function(){a("#photo_thumbs .active").removeClass("active");a("#photo_thumb_"+b).addClass("active");var c=a("#preload").html();""!=c&&(a("#preload").html(""),a("#photo-content").html(c),D.registerOverlay(),a(".sharethis").hideshare({media:a("#photo_src").attr("src"),linkedin:!1,link:window.location.href}),g&&B());a("#photo_wrapper").fadeIn()});window.history.pushState({photo_id:d},
"",mooConfig.url.base+"/photos/view/"+c+"#content")},A=function(){a("#tag-target").fadeOut();a("#tag-input").fadeOut();a("#tag-name").val("")},K=function(b,c){a("#hotspot-item-"+b).fadeOut();a("#hotspot-"+b).fadeOut();a.post(mooConfig.url.base+"/photos/ajax_remove_tag",{tag_id:c})},J=function(b){a("#hotspot-"+b).addClass("hotspothover")},I=function(b){a("#hotspot-"+b).removeClass("hotspothover")},C=function(){a(".deleteAlbum").unbind("click");a(".deleteAlbum").click(function(){var b=a(this).data(),
b=mooConfig.url.base+"/albums/do_delete/"+b.id;p.confirm(h.__("are_you_sure_you_want_to_delete_this_album_all_photos_will_also_be_deleted"),b)})};return{init:function(){L.init()},initOnCreateAlbum:function(){a("#saveBtn").unbind("click");a("#saveBtn").click(function(){a(this).addClass("disabled");f.createItem("albums",!0)})},initOnListing:function(){f.initMoreResults();C()},initOnEditAlbum:function(){a("#select_photos").change(function(){"move"==a(this).val()?a("#album_id").show():a("#album_id").hide()});
C()},initOnViewAlbum:function(){C()},initOnPhotoView:function(b){d=b.photo_id;photo_thumb=b.photo_thumb;y=b.tag_uid;n=b.taguserid;type=b.type;target_id=b.target_id;album_type=b.album_type;album_type_id=b.album_type_id;a("#photo_thumbs ul li").unbind("click");a("#photo_thumbs ul li:not(.viewmore-photo)").click(function(){a("#photo_thumbs ul li").removeClass("active");a(this).addClass("active")});a("#photo_thumb_"+d).addClass("active");a(".sharethis").hideshare({media:mooConfig.url.base+"uploads/photos/thumbnail/"+
d+"/"+photo_thumb,linkedin:!1});a("#photo_src").on("load",function(){if(!q){q=!0;var b=a("#preload").html();""!=b&&(a("#preload").html(""),a("#photo-content").html(b),D.registerOverlay(),a(".sharethis").hideshare({media:a("#photo_src").attr("src"),linkedin:!1,link:window.location.href}),g&&B());a("#photo_wrapper").fadeIn()}});a("#delete_photo").unbind("click");a("#delete_photo").on("click",function(){var b=a(this).data().nextPhoto,b="undefined"!==typeof b?b:"0";p.confirm(h.__("are_you_sure_you_want_to_delete_this_photo"),
mooConfig.url.base+"/photos/ajax_remove/photo_id:"+d+"/next_photo:"+b)});a(".set_cover").unbind("click");a(".set_cover").on("click",function(){O()});a(".set_avatar").unbind("click");a(".set_avatar").on("click",function(){P()});a("#tagPhoto").unbind("click");a("#tagPhoto").click(function(){g?(g=!1,a("#tag-wrapper img").css("cursor","default"),a("#tagPhoto a").html(h.__("tag_photo")),a("#tag-name").unbind(),a("#tag-submit").unbind(),A()):B()});a(".photoDetailTags").on("mouseout",function(){var b=a(this).data();
I("0-"+b.tagId)}).on("mouseover",function(){var b=a(this).data();J("0-"+b.tagId)});a(".photoDetailRemoveTags").unbind("click");a(".photoDetailRemoveTags").on("click",function(){var b=a(this).data();K("0-"+b.id,b.id)});M.initLikePhoto();G();a("#photo_load_btn").unbind("click");a("#photo_load_btn").on("click",function(){H()});N()},initShowPhoto:G}});