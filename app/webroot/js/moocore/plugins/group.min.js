(function(a,e){"function"===typeof define&&define.amd?define("jquery mooBehavior mooFileUploader mooAlert mooAjax mooMention mooTopic mooEmoji mooButton mooOverlay mooGlobal mooPhrase spinner autogrow tipsy tinyMCE typeahead bloodhound tagsinput".split(" "),e):"object"===typeof exports?module.exports=e(require("jquery")):a.mooGroup=e()})(this,function(a,e,p,q,k,w,x,y,g,r,t,c){var u=function(){a(".deleteGroup").unbind("click");a(".deleteGroup").click(function(){var b=a(this).data();b=mooConfig.url.base+
"/groups/do_delete/"+b.id;q.confirm(c.__("are_you_sure_you_want_to_remove_this_group_br_all_group_contents_will_also_be_deleted"),b)})},l=function(b,d){a.fn.SimpleModal({btn_ok:c.__("btn_ok"),btn_cancel:c.__("btn_cancel"),callback:function(){a.post(mooConfig.url.base+"/topics/ajax_delete/"+b,function(b){f("topics",mooConfig.url.base+"/topics/browse/group/"+d);"0"!=a("#group_topics_count").html()&&a("#group_topics_count").html(parseInt(a("#group_topics_count").html())-1)})},title:c.__("please_confirm"),
contents:c.__("are_you_sure_you_want_to_remove_this_topic"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},z=function(){a(".cancelTopic").unbind("click");a(".cancelTopic").on("click",function(){var b=a(this).data();a("#profile-content").load(b.url,{noCache:1},function(b){a("#profile-content").html(b)})});a(".cancelTopic1").unbind("click");a(".cancelTopic1").on("click",function(){var b=a(this).data();f("topics",b.url)})},f=function(b,d,c){a("#"+b).children(".badge_counter").hide();a("#"+
b).spin("tiny");var m=a(".groupId").attr("data-id");k.post({url:d,data:{group_id:m}},function(d){a("#"+b).children(".badge_counter").fadeIn();a("#"+b).spin(!1);c?a("#profile-content").html(d.data):a("#profile-content").html(d);a("textarea").autogrow();a(".tip").tipsy({html:!0,gravity:"s"});r.registerImageOverlay();a(".tipsy").remove();w.init("postComment");y.init(a(d).find("textarea").attr("id"))})},v=function(b,d){var c="save";"topics"==b&&a("#editor").val(tinyMCE.activeEditor.getContent());d&&(c=
"save");g.disableButton("ajaxCreateButton");var e=a("#createForm #id").val();k.post({url:mooConfig.url.base+"/"+b+"/"+c,data:a("#createForm").serialize()},function(d){g.enableButton("ajaxCreateButton");d=a.parseJSON(d);1==d.result?(f(b,mooConfig.url.base+"/"+b+"/ajax_view/"+d.id),void 0===e&&a("#group_"+b+"_count").html(parseInt(a("#group_"+b+"_count").html())+1)):(a(".error-message").show(),a(".error-message").html(d.message))})};return{initOnCreate:function(){new p.fineUploader({element:a("#select-0")[0],
multiple:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i> '+c.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/group/group_upload/avatar"},callbacks:{onError:t.errorHandler,onComplete:function(b,d,c){a("#item-avatar").attr("src",c.file_url);a("#item-avatar").show();a("#photo").val(c.file_path)}}});a("#saveBtn").unbind("click");a("#saveBtn").click(function(){a(this).addClass("disabled");
null!==tinyMCE.activeEditor&&a("#editor").val(tinyMCE.activeEditor.getContent());null!==tinyMCE.activeEditor&&a("#editor").val(tinyMCE.activeEditor.getContent());e.createItem("groups",!0)})},initOnView:function(){a(".leaveGroup").unbind("click");a(".leaveGroup").on("click",function(){var b=a(this).data();b=mooConfig.url.base+"/groups/do_leave/"+b.id;q.confirm(c.__("are_you_sure_you_want_to_leave_this_group"),b)});a("#profile-content").unbind("click");a("#profile-content").on("click","#fetchButton",
function(){a("#fetchButton").spin("small");a("#videoForm .error-message").hide();g.disableButton("fetchButton");k.post({url:mooConfig.url.base+"/videos/aj_validate",data:a("#createForm").serialize()},function(b){g.enableButton("fetchButton");b?(a("#fetchForm .error-message").html(a.parseJSON(b).error),a("#fetchForm .error-message").show(),a("#fetchButton").spin(!1)):k.post({url:mooConfig.url.base+"/videos/fetch",data:a("#createForm").serialize()},function(d){g.enableButton("fetchButton");a("#fetchForm").slideUp();
a("#videoForm").html(b)})});return!1});u();var b=a(".topicId").attr("data-id"),d=a(".videoId").attr("data-id"),m=a(".commentId").attr("data-id"),e=a(".replyId").attr("data-id"),n="",h=a(".tab").attr("data-id"),l=a(".isEdit").attr("data-id");"0"!==m&&(n="/comment_id:"+m,"0"!==e&&(n+="/reply_id:"+e));"0"!==b&&(a("#browse li").removeClass("current"),a("#topics").parent().addClass("current"),"0"!==l?f("topics",mooConfig.url.base+"/topics/group_create/"+b):f("topics",mooConfig.url.base+"/topics/ajax_view/"+
b));"0"!==d&&(a("#browse li").removeClass("current"),a("#videos").parent().addClass("current"),f("videos",mooConfig.url.base+"/videos/ajax_view/"+d+n));0<a("#"+h).length&&(a("#"+h).spin("tiny"),a("#"+h).children(".badge_counter").hide(),a("#browse .current").removeClass("current"),a("#"+h).parent().addClass("current"),a("#profile-content").load(a("#"+h).attr("data-url"),{noCache:1},function(b){a("#"+h).spin(!1);a("#"+h).children(".badge_counter").fadeIn();a("textarea").autogrow();a(".tip").tipsy({html:!0,
gravity:"s"});r.registerOverlay()}))},initOnListing:function(){e.initMoreResults();u()},initTabVideo:function(){a(".cancelVideo").unbind("click");a(".cancelVideo").click(function(){var b=a(this).data();f("videos",mooConfig.url.base+"/videos/ajax_view/"+b.id)});a(".saveVideo").unbind("click");a(".saveVideo").click(function(){a("#videoModal").modal("hide");v("videos",!0)})},initTabPhoto1:function(){a(".groupUploadPhoto").unbind("click");a(".groupUploadPhoto").click(function(){var b=a(this).data();f("photos",
mooConfig.url.base+"/photos/ajax_upload/Group_Group/"+b.groupId)});e.initMoreResults()},initTabPhoto2:function(){var b=[],d=a("#target_id").val(),e=a("type").val(),f=new p.fineUploader({element:a("#photos_upload")[0],autoUpload:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i> '+c.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/photo/photo_upload/album/"+
e+"/"+d},callbacks:{onError:t.errorHandler,onComplete:function(d,c,e){b.push(e.photo);a("#new_photos").val(b.join(","));a("#nextStep").show()}}});a("#triggerUpload").unbind("click");a("#triggerUpload").click(function(){f.uploadStoredFiles()});a("#nextStep").unbind("click");a("#nextStep").click(function(){a("#loadingSpin").spin("tiny");a("#uploadPhotoForm").submit();a(this).addClass("disabled")})},initTabTopic:function(){},initAjaxInvite:function(){var b=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.name)},
queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mooConfig.url.base+"/users/friends.json",cache:!1,filter:function(b){return a.map(b.data,function(a){return a})}},identify:function(a){return a.id}});b.initialize();a("#friends").tagsinput({freeInput:!1,itemValue:"id",itemText:"name",typeaheadjs:{name:"friends_userTagging",displayKey:"name",highlight:!0,limit:10,source:b.ttAdapter(),templates:{notFound:['<div class="empty-message">',c.__("no_results"),"</div>"].join(" "),suggestion:function(b){return""!=
a("#friends").val()&&-1!=a("#friends").val().split(",").indexOf(b.id)?'<div class="empty-message" style="display:none">'+c.__("no_results")+"</div>":['<div class="suggestion-item">','<img alt src="'+b.avatar+'"/>','<span class="text">'+b.name+"</span>","</div>"].join("")}}}});a("#sendButton").unbind("click");a("#sendButton").click(function(){a("#sendButton").spin("small");g.disableButton("sendButton");a(".error-message").hide();k.post({url:mooConfig.url.base+"/groups/ajax_sendInvite",data:a("#sendInvite").serialize()},
function(b){g.enableButton("sendButton");a("#sendButton").spin(!1);b=a.parseJSON(b);1==b.result?a("#simple-modal-body").html(b.msg):(a(".error-message").show(),a(".error-message").html(b.message))});return!1});a("#invite_type_group").change(function(){a("#invite_friend").hide();a("#invite_email").hide();"1"==a("#invite_type_group").val()?a("#invite_friend").show():a("#invite_email").show()})},initOnTopicList:function(){a(".deleteTopic").unbind("click");a(".deleteTopic").on("click",function(){var b=
a(this).data();l(b.id,b.group)});a(".createGroupTopic").unbind("click");a(".createGroupTopic").on("click",function(){f("topics",mooConfig.url.base+"/topics/group_create")});a(".ajaxLoadTopicDetail").unbind("click");a(".ajaxLoadTopicDetail").on("click",function(){var b=a(this).data();f("topics",b.url)});a(".ajaxLoadTopicEdit").unbind("click");a(".ajaxLoadTopicEdit").on("click",function(){var b=a(this).data();f("topics",b.url)});e.initMoreResults()},initOnCreateGroupTopic:function(){z();a("#toggleUploader").unbind("click");
a("#toggleUploader").on("click",function(){x.toggleUploader()});a("#ajaxCreateButton").unbind("click");a("#ajaxCreateButton").on("click",function(){v("topics",!0)});a(".deleteTopic").unbind("click");a(".deleteTopic").on("click",function(){var b=a(this).data();l(b.id,b.group)});var b="advlist autolink lists link image charmap print preview hr anchor pagebreak searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking save table  directionality emoticons template paste textcolor";
mooConfig.isMobile&&(b="textcolor emoticons fullscreen");tinyMCE.remove("textarea#editor");tinyMCE.init({selector:"textarea#editor",language:mooConfig.tinyMCE_language,theme:"modern",skin:"light",plugins:[b],toolbar1:"styleselect | bold italic | bullist numlist outdent indent | forecolor backcolor emoticons | link unlink anchor image | preview fullscreen code",image_advtab:!0,directionality:"ltr",width:580,height:150,menubar:!1,forced_root_block:"div",relative_urls:!1,remove_script_host:!0,document_base_url:mooConfig.url.base,
browser_spellcheck:!0,contextmenu:!1,entity_encoding:"raw"})},removeMember:function(b){a.fn.SimpleModal({btn_ok:c.__("btn_ok"),btn_cancel:c.__("btn_cancel"),callback:function(){a.post(mooConfig.url.base+"/groups/ajax_remove_member",{id:b},function(){a("#member_"+b).fadeOut();"0"!=a("#group_user_count").html()&&a("#group_user_count").html(parseInt(a("#group_user_count").html())-1)})},title:c.__("please_confirm"),contents:c.__("are_you_sure_you_want_to_remove_this_member"),model:"confirm",hideFooter:!1,
closeButton:!1}).showModal();return!1},changeAdmin:function(b,d){var e=c.__("are_you_sure_you_want_to_make_this_member_a_group_admin");"remove"==d&&(e=c.__("are_you_sure_you_want_to_demote_this_group_admin"));a.fn.SimpleModal({btn_ok:c.__("btn_ok"),btn_cancel:c.__("btn_cancel"),callback:function(){a.post(mooConfig.url.base+"/groups/ajax_change_admin",{id:b,type:d},function(){window.location.reload()})},title:c.__("please_confirm"),contents:e,model:"confirm",hideFooter:!1,closeButton:!1}).showModal();
return!1},loadPage:f,initOnAjaxGroupVideo:function(){a("#profile-content").unbind("click");a("#profile-content").on("click","#share-new",function(){var b=a(this).data();k.post({url:b.url,data:{group_id:b.id}},function(b){a("#videoModal .modal-content").html(b)})})},initOnAjaxViewTopic:function(b){a(".ajaxLoadTopicEdit").unbind("click");a(".ajaxLoadTopicEdit").on("click",function(){var b=a(this).data();f("topics",b.url)});a(".deleteTopic").unbind("click");a(".deleteTopic").on("click",function(){var b=
a(this).data();l(b.id,b.group)});window.history.pushState({},"",b)}}});