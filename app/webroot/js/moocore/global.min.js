(function(a,e){"function"===typeof define&&define.amd?define("jquery mooAjax mooButton mooAlert mooPhrase spinner tokeninput".split(" "),e):"object"===typeof exports?module.exports=e(require("jquery")):a.mooGlobal=e()})(this,function(a,e,f,g,c){return{initInviteFriendBtn:function(b){a("#inviteButton").unbind("click");a("#inviteButton").click(function(){a("#inviteButton").spin("small");f.disableButton("inviteButton");a(".error-message").hide();e.post({url:mooConfig.url.base+"/friends/ajax_invite?mode="+
b,data:a("#inviteForm").serialize()},function(d){f.enableButton("inviteButton");a("#inviteButton").spin(!1);d=a.parseJSON(d);1==d.result?"model"==b?a("#inviteForm").parent().parent().parent().html(c.__("your_invitation_has_been_sent")):(a("#to").val(""),a("#message").val(""),a(".error-message").hide(),g.alert(c.__("your_invitation_has_been_sent")),"object"==typeof grecaptcha&&grecaptcha.reset()):(a(".error-message").show(),a(".error-message").html(d.message))});return!1})},initConversationSendBtn:function(){a("#friends").tokenInput(mooConfig.url.base+
"/friends/do_get_json",{preventDuplicates:!0,hintText:c.__("enter_a_friend_s_name"),noResultsText:c.__("no_results"),tokenLimit:20,resultsFormatter:function(a){return"<li>"+a.avatar+a.name+"</li>"}});a("#sendButton").unbind("click");a("#sendButton").click(function(){f.disableButton("sendButton");a("#sendButton").spin("small");a.post(mooConfig.url.base+"/conversations/ajax_doSend",a("#sendMessage").serialize(),function(b){f.enableButton("sendButton");a("#sendButton").spin(!1);b=a.parseJSON(b);1==b.result?
(a("#subject").val(""),a("#message").val(""),a(".error-message").hide(),a("#themeModal").modal("hide"),g.alert(c.__("your_message_has_been_sent"))):(a(".error-message").show(),a(".error-message").html(b.message))});return!1})},initLeaveConversation:function(){a(".leaveConversation").unbind("click");a(".leaveConversation").on("click",function(){var b=a(this).data();g.confirm(b.msg,b.url)})},errorHandler:function(b,d,h){0==mooConfig.product_mode&&(h=c.__("upload_error"));0<a(this._element).find(".qq-upload-list .errorUploadMsg").length?
a(this._element).find(".qq-upload-list .errorUploadMsg").html(h):a(this._element).find(".qq-upload-list").prepend('<div class="errorUploadMsg">'+h+"</div>");a(this._element).find(".qq-upload-fail").remove()},initConversationAjaxAdd:function(){a("#friends").tokenInput(mooConfig.url.base+"/friends/do_get_json",{preventDuplicates:!0,hintText:c.__("enter_a_friend_s_name"),noResultsText:c.__("no_results"),tokenLimit:20,resultsFormatter:function(a){return"<li>"+a.avatar+a.name+"</li>"}});a("#sendButton").click(function(){f.disableButton("sendButton");
a.post(mooConfig.url.base+"/conversations/ajax_doAdd",a("#sendMessage").serialize(),function(b){f.enableButton("sendButton");b=a.parseJSON(b);1==b.result?window.location.reload():(a(".error-message").show(),a(".error-message").html(b.message))});return!1})},initMsgList:function(){a(".markMsgStaus").unbind("click");a(".markMsgStaus").click(function(){var b=a(this).data(),d=a(this);e.post({url:mooConfig.url.base+"/conversations/mark_read",data:{id:b.id,status:b.status}},function(b){b=a.parseJSON(b);
var c=a("#messages .badge_counter").html();"1"===b.status?(d.parents("li:first").addClass("unread"),d.hide(),d.prev().show(),a("#messages .badge_counter").html(parseInt(c)+1),0<a(".conversation_count").length?a(".conversation_count").html(parseInt(c)+1):a("#conversationDropdown").append('<span class="conversation_count">1</span>')):(d.parents("li:first").removeClass("unread"),d.hide(),d.next().show(),a("#messages .badge_counter").html(parseInt(c)-1),0<parseInt(c)-1?0<a(".conversation_count").length?
a(".conversation_count").html(parseInt(c)-1):a("#conversationDropdown").append('<span class="conversation_count">1</span>'):a(".conversation_count")&&a(".conversation_count").remove())})})}}});