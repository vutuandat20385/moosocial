(function(a,e){"function"===typeof define&&define.amd?define("jquery mooPhrase mooBehavior mooMention mooEmoji mooFileUploader mooUser mooButton mooGlobal mooResponsive mooAttach mooComment mooLike mooTooltip mooAlert autogrow spinner".split(" "),e):"object"===typeof exports?module.exports=e(require("jquery")):a.mooActivities=e()})(this,function(a,e,k,l,E,F,G,w,H,I,J,h,K,m,L){var N=function(){a(".removeTags").unbind("click");a(".removeTags").click(function(){var b=a(this).data();M(b.activityId,b.activityItemType)})},
    M=function(b,c){a.fn.SimpleModal({btn_ok:e.__("confirm"),btn_cancel:e.__("cancel"),callback:function(){a.post(mooConfig.url.base+"/activities/ajax_remove_tags",{item_id:b,item_type:c},function(){window.location.reload()})},title:e.__("remove_tags"),contents:e.__("remove_tags_contents"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},O=function(){a(".showAllComments").unbind("click");a(".showAllComments").on("click",function(){var b=a(this).data().id;a("#comments_"+b+" .hidden").fadeIn();
        a("#comments_"+b+" .hidden").attr("class","");a("#all_comments_"+b).hide()})},P=function(b){a.fn.SimpleModal({btn_ok:e.__("ok"),btn_cancel:e.__("cancel"),callback:function(){a.post(mooConfig.url.base+"/activities/ajax_remove",{id:b},function(){a("#activity_"+b).fadeOut("normal",function(){a("#activity_"+b).remove();a("body").trigger("afterRemoveActivityCallback",[])})})},title:e.__("please_confirm"),contents:e.__("please_confirm_remove_this_activity"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},
    R=function(){a(".editActivity").unbind("click");a(".editActivity").click(function(){var b=a(this).data();Q(b.activityId)})},S=function(){a(".removeActivity").unbind("click");a(".removeActivity").click(function(){var b=a(this).data();P(b.activityId)})},t=[],Q=function(b){0==a("#activity_edit_"+b).length&&a.post(mooConfig.url.base+"/activities/ajax_loadActivityEdit/"+b,function(c){a("#activity_feed_content_text_"+b+" .comment_message").hide();a(c).insertAfter(a("#activity_feed_content_text_"+b+" .comment_message"));
        t.push(b);u();l.init(a(c).find("textarea").attr("id"),"edit_activity");E.init(a(c).find("textarea").attr("id"));a("body").trigger("afterLoadFormEditActivityCallback",[])})},x=function(b){a("#message_edit_"+b).siblings(".textoverlay")&&a("#message_edit_"+b).destroyOverlayInstance(a("#message_edit_"+b));a("#activity_feed_content_text_"+b+" .comment_message").show();a("#activity_edit_"+b).remove();b=a.inArray(b,t);t.splice(b,1);a("body").trigger("afterCancelFormEditActivityCallback",[])},T=function(b){if(""!=
        a.trim(a("#message_edit_"+b).val())){var c=0!=a("#message_edit_"+b+"_hidden").length?a("#message_edit_"+b+"_hidden").val():a("#message_edit_"+b).val();a.post(mooConfig.url.base+"/activities/ajax_editActivity/"+b,{message:c},function(c){a("#message_edit_"+b).siblings(".textoverlay")&&a("#message_edit_"+b).destroyOverlayInstance(a("#message_edit_"+b));a("#activity_feed_content_text_"+b+" .comment_message").html(a(c).html());a("#history_activity_"+b).show();x(b)})}},U=function(b){a.fn.SimpleModal({btn_ok:e.__("ok"),
        btn_cancel:e.__("cancel"),callback:function(){a.post(mooConfig.url.base+"/comments/ajax_remove",{id:b},function(){a("#photo_comment_"+b).fadeOut("normal",function(){a("#photo_comment_"+b).remove()})})},title:e.__("please_confirm"),contents:e.__("please_confirm_remove_this_activity"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},V=function(b){if(""!=a.trim(a("#commentForm_"+b).val())||""!=a("#comment_image_"+b).val()){a("#commentButton_"+b+" a").addClass("disabled");a("#commentButton_"+
        b+" a").prepend('<i class="icon-refresh icon-spin"></i>');var c=0<a("#commentForm_"+b).siblings("input.messageHidden").length?a("#commentForm_"+b).siblings("input.messageHidden").val():a("#commentForm_"+b).val();a.post(mooConfig.url.base+"/activities/ajax_comment",{activity_id:b,thumbnail:a("#comment_image_"+b).val(),comment:c},function(c){""!=c&&(y(b,c),c=a("#commentForm_"+b),l.resetMention(c),m.init())})}},W=function(b,c,d){if(""!=a.trim(a("#commentForm_"+d).val())||""!=a("#comment_image_"+d).val()){a("#commentButton_"+
        d+" a").prepend('<i class="icon-refresh icon-spin"></i>');a("#commentButton_"+d+" a").addClass("disabled");var e="";e=0<a("#commentForm_"+d).siblings(".messageHidden").length?a("#commentForm_"+d).siblings(".messageHidden").val():a("#commentForm_"+d).val();a.post(mooConfig.url.base+"/comments/ajax_share",{type:b,target_id:c,thumbnail:a("#comment_image_"+d).val(),message:e,activity:1},function(b){""!=b&&(y(d,b),b=a("#commentForm_"+d),l.resetMention(b),m.init())})}},y=function(b,c){"1"===mooConfig.comment_sort_style?
        a("#newComment_"+b).before(c):a("#newComment_"+b).after(c);a(".slide").slideDown();a("#commentButton_"+b+" a").removeClass("disabled");a("#commentButton_"+b+" a i").remove();a("#commentForm_"+b).val("");a(".commentBox").css("height","27px");a("#comment_preview_image_"+b).html("");a("#comment_image_"+b).val("");a("#comment_button_attach_"+b).show();k.registerImageComment();u()},X=function(b,c,d){a.post(mooConfig.url.base+"/activities/ajax_changeActivityPrivacy/",{activityId:c,privacy:d},function(a){if(""!=
        a){a=JSON.parse(a);var d=b.parents(".dropdown");d.find("a#permission_"+c).attr("original-title",a.text);d.find("a#permission_"+c+" i").html(a.icon);d.find(".dropdown-menu li a").removeClass("n52");b.addClass("n52")}})},u=function(b){a("textarea:not(.no-grow)").autogrow();N();R();S();h.initEditActivityComment();h.initRemoveActivityComment();h.initRemoveItemComment();a("body").off("click.activity","a.admin-or-owner-confirm-delete-photo-comment").on("click.activity","a.admin-or-owner-confirm-delete-photo-comment",
        function(){var b=a(this).data();U(b.commentId)});a("body").off("click.activity","a.viewer-submit-comment").on("click.activity","a.viewer-submit-comment",function(){var b=a(this).data();V(b.activityId)});a("body").off("click.activity","a.viewer-submit-item-comment").on("click.activity","a.viewer-submit-item-comment",function(){var b=a(this).data();W(b.itemType,b.activityItemId,b.activityId)});a("body").off("click.activity","a.activity_reply_comment_button").on("click.activity","a.activity_reply_comment_button",
        function(){var b=a(this).data();type=b.type;id=b.id;z(type,id,0,b.activity)});a("body").off("click.activity","a.activity_reply_comment").on("click.activity","a.activity_reply_comment",function(){var b=a(this).data();button=a(this);type=b.type;id=b.id;typeid="";"comment"!=type&&(typeid="activity");if(""!=a.trim(a("#"+typeid+"commentReplyForm"+id).val())||""!=a("#"+typeid+"comment_reply_image_"+id).val())a("#"+typeid+"commentReplyButton_"+id+" a").prepend('<i class="icon-refresh icon-spin"></i>'),a("#"+
        typeid+"commentReplyButton_"+id+" a").addClass("disabled"),b="",b=0<a("#"+typeid+"commentReplyForm"+id).siblings(".messageHidden").length?a("#"+typeid+"commentReplyForm"+id).siblings(".messageHidden").val():a("#"+typeid+"commentReplyForm"+id).val(),a.post(mooConfig.url.base+"/comments/ajax_share",{activity:1,type:type,target_id:id,thumbnail:a("#"+typeid+"comment_reply_image_"+id).val(),message:b},function(b){""!=b&&(a("#"+typeid+"comments_reply_"+id).hasClass("isLoadNew")?a("#"+typeid+"newComment_reply_"+
        id).before(b):"1"===mooConfig.reply_sort_style?a("#"+typeid+"newComment_reply_"+id).before(b):a("#"+typeid+"newComment_reply_"+id).after(b),a(".slide").slideDown(),button.removeClass("disabled"),a("#"+typeid+"commentReplyForm"+id).val(""),a(".commentBox").css("height","27px"),a("#"+typeid+"comment_reply_preview_image_"+id).html(""),a("#"+typeid+"comment_reply_image_"+id).val(""),a("#"+typeid+"comment_reply_button_attach_"+id).show(),k.registerImageComment(),b=a("#"+typeid+"commentReplyForm"+id),l.resetMention(b),
        m.init())})});h.initReplyReply();a("body").off("click.activity","a.activity_reply_comment_viewmore").on("click.activity","a.activity_reply_comment_viewmore",function(){var b=a(this).data();type=b.type;id=b.id;var d=b.close;b=b.activity;"undefined"==typeof d&&(d=0);z(type,id,d,b)});a("body").off("click.activity","a.change-activity-privacy").on("click.activity","a.change-activity-privacy",function(){var b=a(this).data();X(a(this),b.activityId,b.privacy)});h.initShowCommentForm();K.initLikeActivity();
        h.initRemoveItemComment();h.initEditItemComment();h.initShowCommentBtn();O();k.initMoreResults();Y();k.initFeedForm()},z=function(b,c,d,e){a(".activity_reply_comment_viewmore").each(function(){data=a(this).data();if(data.id==c&&data.type==b)return a(this).parent().remove(),!0});var g="";if("comment"==b){g="comments_reply_"+c;if(a("#newComment_reply_"+c).is(":visible")&&!a("#"+g).hasClass("isLoadNew")){a("#newComment_reply_"+c+" .commentBox").focus();return}a("#newComment_reply_"+c).show();a("#newComment_reply_"+
        c+" .commentBox").focus()}else{g="activitycomments_reply_"+c;if(a("#activitynewComment_reply_"+c).is(":visible")&&!a("#"+g).hasClass("isLoadNew")){a("#activitynewComment_reply_"+c+" .commentBox").focus();return}a("#activitynewComment_reply_"+c).show();a("#activitynewComment_reply_"+c+" .commentBox").focus()}var f=mooConfig.url.base+"/comments/browse/"+b+"/"+c+"/id_content:"+g;"undefined"!=typeof d&&(f+="/is_close_comment:"+d);"undefined"!=typeof e&&(f+="/activity_id:"+e);a.post(f,function(b){""!=
    b&&(a("#"+g).hasClass("isLoadNew")&&(a("#"+g+">li:not(:last-child)").remove(),a("#"+g).removeClass("isLoadNew")),"1"===mooConfig.reply_sort_style?a("#"+g).prepend(b):a("#"+g).append(b),m.init(),k.registerImageComment())})},B=function(b){var c=a("#message").val();b=(result=b.match(/\b([\d\w\.\/\+\-\?:]*)((ht|f)tp(s|):\/\/|[\d\d\d|\d\d]\.[\d\d\d|\d\d]\.|www\.|\.tv|\.ac|\.com|\.edu|\.gov|\.int|\.mil|\.net|\.org|\.biz|\.info|\.name|\.pro|\.museum|\.co)([\d\w\.\/%\+\-=&amp;\?:\\&quot;',\|~;]*)\b/gi))?
        result[0]:void 0;if(!q.hasOwnProperty(b)&&b&&("http://"==v(b,0,7)||"https://"==v(b,0,8)||"www."==v(b,0,4))){var d=n(b,"https://",0),e=n(b,"http://",0);if(0===d||0===e){d=n(b,"youtube.com",0);e=n(b,"youtu.be",0);var g=n(b,"vimeo.com",0);d||e||g?(a(".userTagging-userShareVideo").removeClass("hidden"),a(".userTagging-userShareLink").addClass("hidden"),a("#userShareLink").val(""),a("#userShareVideo").val(b),A("userShareVideo",b,!0,c)):(a(".userTagging-userShareLink").removeClass("hidden"),a(".userTagging-userShareVideo").addClass("hidden"),
        a("#userShareVideo").val(""),a("#userShareLink").val(b),A("userShareLink",b,!0,c))}}},v=function(a,c,d){0>c&&(c+=a.length);d=void 0==d?a.length:0>d?d+a.length:d+c;d<c&&(d=c);return a.substring(c,d)},n=function(a,c,d){a=(a+"").indexOf(c,d||0);return-1===a?!1:a},Z=function(){a(".removeImage").unbind("click");a(".removeImage").on("click",function(){a(this).parent().remove();a("#shareImage").val("0")});a(".removeContent").unbind("click");a(".removeContent").on("click",function(){C()})},C=function(){""!=
    a("#userShareLink").val().trim()&&(q[a("#userShareLink").val().trim()]="1");""!=a("#userShareVideo").val().trim()&&(q[a("#userShareVideo").val().trim()]="1");a("#preview_link").remove();a("#userShareLink").val("");a("#userShareVideo").val("");a("#shareImage").val("1");a("body").trigger("afterDestroyPreviewLinkWallCallback",[])},r=!1,p={},q={},A=function(b,c,d,e){var g=a(".userTagging-"+b);p.hasOwnProperty(c)||g.spin("tiny");setTimeout(function(){r||(p.hasOwnProperty(c)?(console.log(p[c]),r=!0,D(g,
        c,d,e,p[c])):(r=!0,a.post(mooConfig.url.base+"/activities/ajax_preview_link",{content:c},function(a){p[c]=a;g.spin(!1);D(g,c,d,e,a)})))},0)},D=function(b,c,d,e,g){a("#preview_link").remove();c=jQuery.parseJSON(g);if(!jQuery.isEmptyObject(c)){if("undefined"!==typeof c.title&&"404 Not Found"!==c.title&&"403 Forbidden"!==c.title){var f='<div class="activity_item" id="preview_link">';"undefined"!==typeof c.image&&""!=c.image&&(f+='<div class="activity_left"><a class="removePreviewlink removeImage" href="javascript:void(0)"><i class="icon-delete material-icons">clear</i></a>',
        f=-1!=c.image.indexOf("http")?f+('<img src="'+c.image+'" class="img_wrapper2">'):f+('<img src="'+mooConfig.url.base+"/uploads/links/"+c.image+'" class="img_wrapper2">'),f+='<input type="hidden" name="data[share_image]" id="userShareLink" value="1"></div>');f=""!=c.image?f+'<div class="activity_right">':f+"<div>";f=f+'<a class="removePreviewlink removeContent" href="javascript:void(0)"><i class="icon-delete material-icons">clear</i></a>'+('<a class="attachment_edit_link feed_title" href="'+c.url+'" target="_blank" rel="nofollow">');
        f+="<strong>"+c.title+"</strong>";f+="</a>";"undefined"!==typeof c.description&&""!=c.description&&(f=f+'<div class="attachment_body_description">'+('<a class="attachment_edit_link comment_message feed_detail_text">'+c.description+"</a>"),f+="</div>");f+='<input type="hidden" name="data[share_text]" id="userShareLink" value="1"></div></div>'}else"undefined"!==typeof c.type&&"img"==c.type&&(f='<div class="activity_item" id="preview_link">',"undefined"!==typeof c.image&&""!=c.image&&(f=f+'<div class="activity_parse_img"><a class="removePreviewlink removeContent" href="javascript:void(0)"><i class="icon-delete material-icons">clear</i></a>'+
        ('<img src="'+c.image+'" class="img_wrapper2">'),f+='<input type="hidden" name="data[share_image]" id="userShareLink" value="1"></div>'),f+='<input type="hidden" name="data[share_text]" id="userShareLink" value="1"></div>');""!=f&&(b.append(f),d&&(a(".textoverlay").text(e),a(".autogrow-textarea-mirror").text(e)),Z(),a("body").trigger("afterPreviewLinkWallCallback",[]))}r=!1},aa=function(){if(!G.validateUser())return!1;var b=a("#message").val();""!=a.trim(b)||0<a("#video_destination").length&&""!==
    a("#video_destination").val()||""!=a("#userShareLink").val()||""!=a("#userShareVideo").val()||""!=a("#wall_photo_preview :not(#addMoreImage)").html()&&"add"!=a("#wall_photo_preview :not(#addMoreImage)").html()?(w.disableButton("status_btn"),a("#status_btn").spin("small"),a.post(mooConfig.url.base+"/activities/ajax_share",a("#wallForm").serialize(),function(b){a("#wall_photo").val("");w.enableButton("status_btn");a("#message").val("");a(".userTagging-userShareLink").addClass("hidden");a(".userTagging-userShareVideo").addClass("hidden");
        a("#shareImage").val("1");0<a("#video_destination").length&&""!==a("#video_destination").val()?(a.fn.SimpleModal({model:"content",title:e.__("upload_video_phrase_4"),contents:e.__("upload_video_phrase_0")}).showModal(),setTimeout(function(){a("#simpleModal").hideModal()},3E3)):""!=b&&(0<a(".no-feed").length&&a("#list-content .no-feed").remove(),a("#list-content").prepend(b),a("#message").css("height","36px"),a(".slide").slideDown(),a("#wall_photo_preview span:not(.addMoreImage)").remove(),a("#addMoreImage").hide(),
            a(".form-feed-holder").css("padding-bottom","0px"),b=a(b).find("div[id^=comment_button_attach_]").data("id"),J.registerAttachComment(b));a("#status_btn").spin(!1);I.init();a(".tip").tipsy({html:!0,gravity:"s"});a('[data-toggle="tooltip"]').tooltip();b=a("#wallForm").find("#message");l.resetMention(b);m.init();a("#preview_link").remove();q={};a("#userShareLink").val("");a("#userShareVideo").val("");a("body").trigger("afterPostWallCallbackSuccess",[])}),a(".stt-action .userTagging-userTagging").addClass("hidden"),
        a(".stt-action").css("margin-top","0"),a("#wall_photo_preview").hide(),a("#userTagging").tagsinput("removeAll")):a.fn.SimpleModal({btn_ok:e.__("btn_ok"),btn_cancel:e.__("cancel"),model:"modal",title:e.__("warning"),contents:e.__("share_whats_new_can_not_empty")}).showModal()},Y=function(){a(".closeComment").unbind("click");a(".closeComment").click(function(){var b=a(this).data();a.post(mooConfig.url.base+"/comments/ajax_close",{item_id:b.id,item_type:b.type},function(a){a=JSON.parse(a);1==a.result&&
    L.alert(a.message)});"1"==b.close?(a(this).html(e.__("close_comment")),a(this).data("close",0)):(a(this).html(e.__("open_comment")),a(this).data("close",1))})};return{init:u,initActivityForm:function(){a('[data-toggle="tooltip"]').tooltip();new F.fineUploader({element:a("#select-2")[0],text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i></div>'},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},multiple:!0,request:{endpoint:mooConfig.url.base+
                "/upload/wall"},callbacks:{onError:H.errorHandler,onSubmit:function(b,c){a('<span id="feed_'+b+'" style="background-image:url('+mooConfig.url.base+'/img/indicator.gif);background-size:inherit;background-repeat:no-repeat"></span>').insertBefore(".addMoreImage");a("#wall_photo_preview").show();a("#addMoreImage").show()},onComplete:function(b,c,d,e){d.success&&(a('[data-toggle="tooltip"]').tooltip("hide"),a(this.getItemByFileId(b)).remove(),a('<img src="'+d.file_path+'">').load(function(){var c=a("#feed_"+
                b);c.attr("style","background-image:url("+d.file_path+")");var e=a('<a href="#"><i class="material-icons thumb-review-delete">clear</i></a>');c.append(e);c.find(".thumb-review-delete").unbind("click");c.find(".thumb-review-delete").click(function(b){b.preventDefault();a(this).parents("span").remove();a("#wall_photo").val(a("#wall_photo").val().replace(d.photo+",",""));a("body").trigger("afterDeleteWallPhotoCallback",[d])})}),c=a("#wall_photo").val(),a("#wall_photo").val(c+d.photo+","),C());a("body").trigger("afterUploadWallPhotoCallback",
                [d])}}});a("#addMoreImage").unbind("click");a("#addMoreImage").click(function(){a("#select-2 input[name=file]").click()});a("#message").on("focus",function(){h.showCommentButton(0)});a("#status_btn").unbind("click");a("#status_btn").click(function(){aa()});a("#status_box").slideDown("slow",function(){a("body").trigger("afterShowStatusBoxCallback")});a("#message").on("paste",function(b){""==a("#wall_photo").val().trim()&&0==a("#preview_link").length&&b.originalEvent.clipboardData&&(b=b.originalEvent.clipboardData.getData("text/plain"),
        B(b))});a("#message").on("keydown keyup keypress",function(b){""!=a("#wall_photo").val().trim()||b.ctrlKey||0!=a("#preview_link").length||(b=a(this).val(),B(b))})},initOnAjaxLoadActivityEdit:function(){a(".cancelEditActivity").unbind("click");a(".cancelEditActivity").click(function(){var b=a(this).data();x(b.activityId)});a(".confirmEditActivity").unbind("click");a(".confirmEditActivity").click(function(){var b=a(this).data();T(b.activityId)})}}});